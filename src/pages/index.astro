---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';

interface Banda {
  nombre: string;
  integrantes: number;
}

interface Conjunto {
  nombre: string;
  integrantes: number;
  numeroBloques: number;
  bandas: Banda[];
}

interface Grupo {
  id: number;
  conjuntos: Conjunto[];
}

// Aquí normalmente cargarías los datos de una base de datos o API
const grupos = [
  {
    id: 1,
    conjuntos: [
      {
        nombre: "Gran Trad. Autentica \"Diablada Oruro\"",
        integrantes: 377,
        numeroBloques: null, // No se especificó
        bandas: [
          { nombre: "Banda los Impecables", integrantes: 68 },
          { nombre: "Banda Proyección", integrantes: 67 },
          { nombre: "Banda Decadentes", integrantes: 62 }
        ]
      },
      {
        nombre: "Frat. Hijos del Sol \"Los Incas\"",
        integrantes: 70,
        numeroBloques: 2,
        bandas: [
          { nombre: "Banda Super Tropical", integrantes: 34 }
        ]
      },
      {
        nombre: "Conj. Folk \"Morenada Zona Norte\"",
        integrantes: 260,
        numeroBloques: 7,
        bandas: [
          { nombre: "Banda Poopo", integrantes: 80 },
          { nombre: "Banda Unión Bolivia", integrantes: 50 },
          { nombre: "Banda Super Central Oruro", integrantes: 120 },
          { nombre: "Banda Unión Pagador", integrantes: 77 }
        ]
      },
      {
        nombre: "Frat. Art. Zampoñeros Hijos del Pagador",
        integrantes: 158,
        numeroBloques: 3,
        bandas: [
          { nombre: "Jayamara", integrantes: 46 },
          { nombre: "Kallpa Allwika", integrantes: 30 },
          { nombre: "Zonco Ninas", integrantes: 30 }
        ]
      },
      {
        nombre: "Centro Trad. \"Negritos de Pagador\"",
        integrantes: 106,
        numeroBloques: 3,
        bandas: [
          { nombre: "Tradicional", integrantes: 19 },
          { nombre: "Tradicional", integrantes: 46 },
          { nombre: "Uvas Negras", integrantes: 20 }
        ]
      },
      {
        nombre: "Conj. Folk \"Ahuatiris\"",
        integrantes: 42,
        numeroBloques: 2,
        bandas: [
          { nombre: "Banda", integrantes: 26 }
        ]
      },
      {
        nombre: "Conj. Waca Wacas \"San Agustín\" (Derecho)",
        integrantes: 165,
        numeroBloques: 9,
        bandas: [
          { nombre: "Banda Real Impacto", integrantes: 28 },
          { nombre: "Banda Real Impacto", integrantes: 24 }
        ]
      },
      {
        nombre: "Frat. Morenada \"Central Oruro\"",
        integrantes: 1335,
        numeroBloques: 42,
        bandas: [
          { nombre: "Banda Real Imperial Oruro", integrantes: 164 },
          { nombre: "Banda Poopo Oruro – Bolivia", integrantes: 136 },
          { nombre: "Banda espectacular Bolivia", integrantes: 185 }
        ]
      },
      {
        nombre: "Conj. Caporales Infantiles \"Ignacio León\"",
        integrantes: 280,
        numeroBloques: 12,
        bandas: [
          { nombre: "Banda estudiantil Ignacio León", integrantes: 64 },
          { nombre: "Banda Gran Brillantes", integrantes: 52 }
        ]
      }
    ]
  },
  {
    id: 2,
    conjuntos: [
      {
        nombre: "Conj. Trad. Folk \"Diablada Oruro\"",
        integrantes: 258,
        numeroBloques: 13,
        bandas: [
          { nombre: "Banda 10 de febrero mundial", integrantes: 52 },
          { nombre: "Banda Espectacular Bolívar Oruro", integrantes: 63 },
          { nombre: "Banda Internacional San José", integrantes: 62 }
        ]
      },
      {
        nombre: "Frat. Caporales \"Centralistas\"",
        integrantes: 300,
        numeroBloques: 12,
        bandas: [
          { nombre: "Banda los Decadentes", integrantes: 62 },
          { nombre: "Banda los Huaris", integrantes: 80 },
          { nombre: "Banda Unión Juvenil", integrantes: 40 }
        ]
      },
      {
        nombre: "Frat. Morenada Central Oruro (Fund. por la Com. Cocani)",
        integrantes: 1205,
        numeroBloques: 3,
        bandas: [
          { nombre: "banda intercontinental poopo", integrantes: 154 },
          { nombre: "banda central cocani Oruro", integrantes: 132 },
          { nombre: "banda orquesta Proyección Oruro", integrantes: 143 },
          { nombre: "banda espectacular central cocani", integrantes: 122 }
        ]
      },
      {
        nombre: "Conj. Folk \"Tobas Zona Sud\"",
        integrantes: 427,
        numeroBloques: 25,
        bandas: [
          { nombre: "Banda Unión Libertad Oruro", integrantes: 25 },
          { nombre: "Banda ES MAGNIFICO LOS ARDIENTES", integrantes: 51 },
          { nombre: "Banda Armonía", integrantes: 51 },
          { nombre: "Banda Impecables", integrantes: 53 }
        ]
      },
      {
        nombre: "Conj. Negritos \"Unidos de la Saya\"",
        integrantes: 19,
        numeroBloques: 2,
        bandas: [
          { nombre: "Banda", integrantes: 40 }
        ]
      },
      {
        nombre: "Conj. Waca Tokoris \"Urus\"",
        integrantes: 20,
        numeroBloques: 3,
        bandas: [
          { nombre: "Banda real popo Oruro", integrantes: 18 }
        ]
      },
      {
        nombre: "Conj. Folk \"Antawara\"",
        integrantes: 34,
        numeroBloques: 3,
        bandas: [
          { nombre: "Banda Candelaria", integrantes: 43 }
        ]
      },
      {
        nombre: "Conj. Folk Tinkus \"Tolkas\"",
        integrantes: 564,
        numeroBloques: 15,
        bandas: [
          { nombre: "Banda Super Oruro", integrantes: 32 },
          { nombre: "Banda Kollas Oruro", integrantes: 38 },
          { nombre: "Banda super proyección Saracho", integrantes: 32 },
          { nombre: "Banda internacional Juventud Dalence Oruro", integrantes: 35 }
        ]
      }
    ]
  },
  {
    id: 3,
    conjuntos: [
      {
        nombre: "Frat. Art. y Cult. \"La Diablada\"",
        integrantes: 604,
        numeroBloques: 4,
        bandas: [
          { nombre: "Banda 1", integrantes: 89 },
          { nombre: "Banda 2", integrantes: 116 },
          { nombre: "Banda 3", integrantes: 84 },
          { nombre: "Banda 4", integrantes: 94 }
        ]
      },
      {
        nombre: "Conj. Morenada \"Mejillones\"",
        integrantes: 466,
        numeroBloques: 9,
        bandas: [
          { nombre: "Banda gran unión", integrantes: 90 },
          { nombre: "Banda internacional Oruro", integrantes: 75 },
          { nombre: "Banda Gran instrumental poopo", integrantes: 67 },
          { nombre: "Banda unión pagador", integrantes: 104 }
        ]
      },
      {
        nombre: "Frat. Folk \"Llamerada Socavón\"",
        integrantes: 560,
        numeroBloques: 6,
        bandas: [
          { nombre: "Banda Juvenil", integrantes: 53 },
          { nombre: "Banda Internacional 15 de agosto", integrantes: 35 },
          { nombre: "Banda Fusión Juvenil", integrantes: 50 }
        ]
      },
      {
        nombre: "Conj. Folk y Cult. \"Phujllay Oruro\"",
        integrantes: 314,
        numeroBloques: 5,
        bandas: [
          { nombre: "Banda 1", integrantes: 34 },
          { nombre: "Banda 2", integrantes: 32 },
          { nombre: "Banda 3", integrantes: 23 }
        ]
      },
      {
        nombre: "Grupo de Danza Est. \"Suri Sicuri\"",
        integrantes: 83,
        numeroBloques: 5,
        bandas: [
          { nombre: "Banda 8 de septiembre", integrantes: 20 },
          { nombre: "Banda 8 de septiembre", integrantes: 16 }
        ]
      },
      {
        nombre: "Conj. Folk \"Sambos Oruro\"",
        integrantes: 581,
        numeroBloques: 7,
        bandas: [
          { nombre: "Banda Máster", integrantes: 53 },
          { nombre: "Banda Carmen Brillantes", integrantes: 70 },
          { nombre: "Banda Internacional Decadentes", integrantes: 80 },
          { nombre: "Banda Glaxic", integrantes: 50 }
        ]
      },
      {
        nombre: "Frat. \"Cullaguada Oruro\"",
        integrantes: 226,
        numeroBloques: 6,
        bandas: [
          { nombre: "Banda 1", integrantes: 41 },
          { nombre: "Banda 2", integrantes: 28 },
          { nombre: "Banda 3", integrantes: 35 },
          { nombre: "Banda 4", integrantes: 24 }
        ]
      },
      {
        nombre: "Conj. Trad. \"Tobas Zona Central\"",
        integrantes: 1096,
        numeroBloques: 12,
        bandas: [
          { nombre: "Banda milenio", integrantes: 54 },
          { nombre: "Banda Bolivia", integrantes: 75 },
          { nombre: "Banda espectacular super rebeldes", integrantes: 55 },
          { nombre: "Banda los huari", integrantes: 80 }
        ]
      },
      {
        nombre: "Conj. Folk de Zampoñeros \"Kory Majtas\"",
        integrantes: 250,
        numeroBloques: 4,
        bandas: [
          { nombre: "KORY MAJTAS", integrantes: 30 },
          { nombre: "JATUN SONK’O HUAYRAS", integrantes: 35 },
          { nombre: "KORY MAJTA", integrantes: 30 },
          { nombre: "CENTRO CULTURAL KORI LLAJTA", integrantes: 40 }
        ]
      }
    ]
  },
  {
    id: 4,
    conjuntos: [
      {
        nombre: "Conj. \"Diablada Ferroviaria\"",
        integrantes: 805,
        numeroBloques: 28,
        bandas: [
          { nombre: "Banda Real Imperial", integrantes: 35 },
          { nombre: "Banda Original Poopo", integrantes: 97 },
          { nombre: "Banda Imperial Oruro", integrantes: 53 },
          { nombre: "Banda Espectacular Poopó", integrantes: 70 }
        ]
      },
      {
        nombre: "Frat. Reyes Morenos \"Ferrari Ghezzi\"",
        integrantes: 842,
        numeroBloques: 28,
        bandas: [
          { nombre: "Banda Super Central Oruro", integrantes: 87 },
          { nombre: "Banda Intercontinental Poopo Original", integrantes: 116 },
          { nombre: "Banda Real Imperial Oruro Sin Rival", integrantes: 75 },
          { nombre: "Banda Espectacular Bolivia", integrantes: 140 }
        ]
      },
      {
        nombre: "Caporales Reyes de la Tuntuna \"ENAF\"",
        integrantes: 930,
        numeroBloques: 22,
        bandas: [
          { nombre: "Banda Pendex", integrantes: 167 },
          { nombre: "Banda Master", integrantes: 55 },
          { nombre: "Banda Cadilacs", integrantes: 78 },
          { nombre: "Banda Quirquigans", integrantes: 57 }
        ]
      },
      {
        nombre: "Conj. Tinkus \"Los Jairas de Oruro\"",
        integrantes: 926,
        numeroBloques: 18,
        bandas: [
          { nombre: "Banda Internacional Ardientes Oruro", integrantes: 50 },
          { nombre: "Banda Juventud Dalence", integrantes: 39 },
          { nombre: "Banda Kollas Oruro", integrantes: 38 }
        ]
      },
      {
        nombre: "Frat. \"Cullaguada Terribles Quirquinchos\"",
        integrantes: 557,
        numeroBloques: 12,
        bandas: [
          { nombre: "Banda Super Proyección Saracho", integrantes: 32 },
          { nombre: "Banda Poderosa Imperial", integrantes: 47 },
          { nombre: "Banda Poopo Original Gran Instrumental", integrantes: 58 },
          { nombre: "Banda Internacional Juventud Sonora", integrantes: 33 }
        ]
      },
      {
        nombre: "Frat. \"Kallawayas Bolivia\"",
        integrantes: 62,
        numeroBloques: 6,
        bandas: [
          { nombre: "Banda la Nueva Oruro", integrantes: 24 }
        ]
      },
      {
        nombre: "Conj. \"Potolos Chayantas Jhilancos\"",
        integrantes: null, // Integrantes no especificado
        numeroBloques: 8,
        bandas: [
          { nombre: "Banda 1", integrantes: null },
          { nombre: "Banda 2", integrantes: null },
          { nombre: "Banda 3", integrantes: null }
        ]
      },
      {
        nombre: "Conj. Folk. y Cultural \"Doctorcitos Itos\"",
        integrantes: 265,
        numeroBloques: 18,
        bandas: [
          { nombre: "Banda 1", integrantes: null },
          { nombre: "Banda 2", integrantes: null },
          { nombre: "Banda 3", integrantes: null }
        ]
      },
      {
        nombre: "Frat. de Danza Est. \"Intillajta\"",
        integrantes: 32,
        numeroBloques: 4,
        bandas: [
          { nombre: "Banda 1", integrantes: null },
          { nombre: "Banda 2", integrantes: null }
        ]
      }
    ]
  },
  {
  id: 5,
  conjuntos: [
    {
      nombre: "Diablada Art. URUS",
      integrantes: 562,
      numeroBloques: 18,
      bandas: [
        { nombre: "Banda 10 de febrero", integrantes: 76 },
        { nombre: "Banda Sonora Bross Oruro", integrantes: 64 },
        { nombre: "Banda Unión Pagador", integrantes: 70 },
        { nombre: "Proyección Oruro", integrantes: 45 }
      ]
    },
    {
      nombre: "Frat. Cult. Reyes Morenos COMIBOL",
      integrantes: 86,
      numeroBloques: 11,
      bandas: [
        { nombre: "Banda Unión Bolivia", integrantes: 65 }
      ]
    },
    {
      nombre: "Tobas Uru Uru",
      integrantes: 400,
      numeroBloques: 26,
      bandas: [
        { nombre: "Banda Milenio Oruro", integrantes: 50 },
        { nombre: "Banda 2", integrantes: 40 },
        { nombre: "Banda 3", integrantes: 60 }
      ]
    },
    {
      nombre: "Frat. Folk. Cult. Caporales Univ. \"San Simón\"",
      integrantes: 1160,
      numeroBloques: 30,
      bandas: [
        { nombre: "Banda Autenticos decadentes", integrantes: 120 },
        { nombre: "Banda 2", integrantes: 100 },
        { nombre: "Banda 3", integrantes: 80 }
      ]
    },
    {
      nombre: "Conj. Autoctono Wititis",
      integrantes: 412,
      numeroBloques: 10,
      bandas: [
        { nombre: "Grupo autoctono Sonk'o Wayras", integrantes: 82 },
        { nombre: "Grupo autoctono Sajama", integrantes: 78 },
        { nombre: "Grupo Autoctono", integrantes: 74 }
      ]
    },
    {
      nombre: "Conj. Folk. Tinkus Huajchas",
      integrantes: 600,
      numeroBloques: 21,
      bandas: [
        { nombre: "Banda 1", integrantes: 55 },
        { nombre: "Banda 2", integrantes: 45 },
        { nombre: "Banda 3", integrantes: 40 },
        { nombre: "Banda 4", integrantes: 50 }
      ]
    },
    {
      nombre: "Inkas Kollasuyo \"Hijos del Socavón\"",
      integrantes: 59,
      numeroBloques: 4,
      bandas: [
        { nombre: "Banda 1", integrantes: 30 },
        { nombre: "Banda 2", integrantes: 27 }
      ]
    },
    {
      nombre: "Jatun Jallpa",
      integrantes: 100,
      numeroBloques: 6,
      bandas: [
        { nombre: "Conjunto Autoctono", integrantes: 35 },
        { nombre: "Conjunto Autoctono", integrantes: 26 }
      ]
    }
  ]
}
];


// Variables totales para el cálculo
const totalBailarines = grupos.reduce((total, grupo) => 
  total + grupo.conjuntos.reduce((subtotal, conjunto) => subtotal + conjunto.integrantes, 0), 0);

const totalBanderos = grupos.reduce((total, grupo) => 
  total + grupo.conjuntos.reduce((subtotal, conjunto) => 
    subtotal + conjunto.bandas.reduce((bandaTotal, banda) => bandaTotal + banda.integrantes, 0), 0), 0);
---

<Layout title="Carnaval de Oruro 2025 - Datos de Conjuntos">
  <main class="container max-w-[1200px] mx-auto px-4 py-8 bg-gray-100 min-h-screen">
    <h1 class="text-4xl font-bold text-center mb-8 text-gray-800">Carnaval de Oruro 2025 <br>(Primer Convite)</h1>
    
    <div class="mb-8 bg-white shadow rounded-lg p-6">
      <h2 class="text-2xl font-semibold mb-4 text-gray-800">Totales</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-blue-100 p-4 rounded-lg">
          <p class="text-xl font-semibold text-blue-800">Total Bailarines: <span id="total-bailarines">{totalBailarines}</span></p>
        </div>
        <div class="bg-green-100 p-4 rounded-lg">
          <p class="text-xl font-semibold text-green-800">Total Músicos: <span id="total-banderos">{totalBanderos}</span></p>
        </div>
      </div>
    </div>

    <div class="mb-8">
      <h2 class="text-2xl font-semibold mb-4 text-gray-700">Selecciona un conjunto:</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        {grupos.map((grupo) => (
          <div class="bg-white shadow rounded-lg p-4">
            <h3 class="text-xl font-semibold mb-2 text-gray-800">Grupo {grupo.id}</h3>
            <ul>
              {grupo.conjuntos.map((conjunto) => (
                <li>
                  <button
                    class="text-left w-full py-2 px-4 hover:bg-gray-100 rounded transition-colors text-gray-700"
                    data-conjunto={JSON.stringify(conjunto)}
                  >
                    {conjunto.nombre}
                  </button>
                </li>
              ))}
            </ul>
          </div>
        ))}
      </div>
    </div>

    <div id="datos-conjunto" class="bg-white shadow rounded-lg p-6 opacity-0 transition-opacity duration-500">
      <h2 id="nombre-conjunto" class="text-3xl font-bold mb-4 text-gray-800"></h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <p class="text-xl mb-2 text-gray-700">Integrantes: <span id="integrantes"></span></p>
          <p class="text-xl mb-2 text-gray-700">Número de bloques: <span id="bloques"></span></p>
          <p class="text-xl mb-4 text-gray-700">Número de bandas: <span id="num-bandas"></span></p>
          <h3 class="text-2xl font-semibold mb-2 text-gray-800">Bandas:</h3>
          <ul id="lista-bandas" class="list-disc pl-5 text-gray-700"></ul>
        </div>
        <div>
          <canvas id="grafico-bandas" width="400" height="200"></canvas>
        </div>
      </div>
    </div>
	
  </main>
</Layout>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  import { Chart, type ChartConfiguration } from 'chart.js/auto';

  interface Banda {
    nombre: string;
    integrantes: number;
  }

  interface Conjunto {
    nombre: string;
    integrantes: number;
    numeroBloques: number;
    bandas: Banda[];
  }

  document.addEventListener('DOMContentLoaded', () => {
    const botones = document.querySelectorAll<HTMLButtonElement>('[data-conjunto]');
    const datosConjunto = document.getElementById('datos-conjunto');
    const nombreConjunto = document.getElementById('nombre-conjunto');
    const integrantes = document.getElementById('integrantes');
    const bloques = document.getElementById('bloques');
    const numBandas = document.getElementById('num-bandas');
    const listaBandas = document.getElementById('lista-bandas');
    let grafico: Chart | null = null;

    botones.forEach(boton => {
      boton.addEventListener('click', () => {
        const conjunto = JSON.parse(boton.dataset.conjunto || '{}') as Conjunto;
        
        if (nombreConjunto) nombreConjunto.textContent = conjunto.nombre;
        if (integrantes) integrantes.textContent = conjunto.integrantes.toString();
        if (bloques) bloques.textContent = conjunto.numeroBloques.toString() || 'No especificado';
        if (numBandas) numBandas.textContent = conjunto.bandas.length.toString();
        
        if (listaBandas) {
          listaBandas.innerHTML = conjunto.bandas.map(banda => 
            `<li>${banda.nombre}: ${banda.integrantes} integrantes</li>`
          ).join('');
        }
        
        actualizarGrafico(conjunto.bandas);
        
        if (datosConjunto) {
          datosConjunto.classList.remove('opacity-0');
          datosConjunto.classList.add('opacity-100');
        }
      });
    });

    function actualizarGrafico(bandas: Banda[]) {
      const canvas = document.getElementById('grafico-bandas') as HTMLCanvasElement | null;
      if (!canvas) return;

      const ctx = canvas.getContext('2d');
      if (!ctx) return;
      
      if (grafico) {
        grafico.destroy();
      }
      
      const config: ChartConfiguration = {
        type: 'bar',
        data: {
          labels: bandas.map(banda => banda.nombre),
          datasets: [{
            label: 'Integrantes por Banda',
            data: bandas.map(banda => banda.integrantes),
            backgroundColor: [
              'rgba(255, 99, 132, 0.8)',
              'rgba(54, 162, 235, 0.8)',
              'rgba(255, 206, 86, 0.8)',
              'rgba(75, 192, 192, 0.8)',
              'rgba(153, 102, 255, 0.8)',
            ],
            borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(75, 192, 192, 1)',
              'rgba(153, 102, 255, 1)',
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      };
      
      grafico = new Chart(ctx, config);
    }
  });
</script>